\documentclass[sigplan,10pt,anonymous,review]{acmart}%
%\settopmatter{printfolios=true,printccs=false,printacmref=false}
% ??? Commented out?

% \usepackage[english]{babel}
\input{macros.tex}
%%
%% \BibTeX command to typeset BibTeX logo in the docs
\AtBeginDocument{%
  \providecommand\BibTeX{{%
    \normalfont B\kern-0.5em{\scshape i\kern-0.25em b}\kern-0.8em\TeX}}}

%% Rights management information.  This information is sent to you
%% when you complete the rights form.  These commands have SAMPLE
%% values in them; it is your responsibility as an author to replace
%% the commands and values with those provided to you when you
%% complete the rights form.
\setcopyright{acmcopyright}
\copyrightyear{2018}
\acmYear{2018}
\acmDOI{10.1145/1122445.1122456}

%% These commands are for a PROCEEDINGS abstract or paper.
\acmConference[Woodstock '18]{Woodstock '18: ACM Symposium on Neural
  Gaze Detection}{June 03--05, 2018}{Woodstock, NY}
\acmBooktitle{Woodstock '18: ACM Symposium on Neural Gaze Detection,
  June 03--05, 2018, Woodstock, NY}
\acmPrice{15.00}
\acmISBN{978-1-4503-XXXX-X/18/06}


%%
%% Submission ID.
%% Use this when submitting an article to a sponsored event. You'll
%% receive a unique submission ID from the organizers
%% of the event, and this ID should be used as the parameter to this command.
%%\acmSubmissionID{123-A56-BU3}

%%
%% The majority of ACM publications use numbered citations and
%% references.  The command \citestyle{authoryear} switches to the
%% "author year" style.
%%
%% If you are preparing content for an event
%% sponsored by ACM SIGGRAPH, you must use the "author year" style of
%% citations and references.
%% Uncommenting
%% the next command will enable that style.
%%\citestyle{acmauthoryear}

%%
%% end of the preamble, start of the body of the document source.
\begin{document}

%%
%% The "title" command has an optional parameter,
%% allowing the author to define a "short title" to be used in page headers.
\title{Universal Sets in Coq}

%%
%% The "author" command and its associated commands are used to define
%% the authors and their affiliations.
%% Of note is the shared affiliation of the first two authors, and the
%% "authornote" and "authornotemark" commands
%% used to denote shared contribution to the research.
\author{Andrea Condoluci}
\email{andreacondoluci@gmail.com}
\orcid{1234-5678-9012}
\affiliation{%
  \institution{Institute for Clarity in Documentation}
  \streetaddress{P.O. Box 1212}
  \city{Dublin}
  \state{Ohio}
  \postcode{43017-6221}
}

%%
%% By default, the full list of authors will be used in the page
%% headers. Often, this list is too long, and will overlap
%% other information printed in the page headers. This command allows
%% the author to define a more concise list
%% of authors' names for this purpose.
% \renewcommand{\shortauthors}{Trovato and Tobin, et al.}

%%
%% The abstract is a short summary of the work to be presented in the
%% article.
\begin{abstract}
New Foundations (\NF) is a somewhat bizarre alternative to mainstream set theories like Zermeloâ€“Fraenkel (\ZF). The distinguishing feature of \NF{} is permitting the construction of a \emph{universal set}, \ie{} a set that contains all sets (itself, too). Though counterintuitive, \NF{} is capable of expressing ordinary mathematical concepts like well-orders, ordinals, cardinals, natural numbers, and so on. Its adoption, however, is hampered by the fact that after more than 80 years since its introduction, the community has not yet agreed upon its logical consistency.
  
In this paper, we consider two weak sub-theories of \NF{} whose consistency has already been established: \NFTWO{} and \NFO. These theories are obtained from \NF{} by restricting the axiom schema of comprehension to quantifier-free formulas only. We provide an encoding of \NFTWO{} and \NFO{} in the Coq proof assistant, adapting in a non-trivial way the classic encoding of \ZF{} in Coq by Benjamin Werner. To our knowledge, this is the first mechanized consistency proof concerning New Foundations.
\end{abstract}

% %%
% %% The code below is generated by the tool at http://dl.acm.org/ccs.cfm.
% %% Please copy and paste the code instead of the example below.
% %%
% \begin{CCSXML}
% <ccs2012>
%  <concept>
%   <concept_id>10010520.10010553.10010562</concept_id>
%   <concept_desc>Computer systems organization~Embedded systems</concept_desc>
%   <concept_significance>500</concept_significance>
%  </concept>
%  <concept>
%   <concept_id>10010520.10010575.10010755</concept_id>
%   <concept_desc>Computer systems organization~Redundancy</concept_desc>
%   <concept_significance>300</concept_significance>
%  </concept>
%  <concept>
%   <concept_id>10010520.10010553.10010554</concept_id>
%   <concept_desc>Computer systems organization~Robotics</concept_desc>
%   <concept_significance>100</concept_significance>
%  </concept>
%  <concept>
%   <concept_id>10003033.10003083.10003095</concept_id>
%   <concept_desc>Networks~Network reliability</concept_desc>
%   <concept_significance>100</concept_significance>
%  </concept>
% </ccs2012>
% \end{CCSXML}

% \ccsdesc[500]{Computer systems organization~Embedded systems}
% \ccsdesc[300]{Computer systems organization~Redundancy}
% \ccsdesc{Computer systems organization~Robotics}
% \ccsdesc[100]{Networks~Network reliability}

%%
%% Keywords. The author(s) should pick words that accurately describe
%% the work being presented. Separate the keywords with commas.
\keywords{set theory, New Foundations, universal set}

%%
%% This command processes the author and affiliation and title
%% information and builds the first part of the formatted document.
\maketitle

\section{Introduction}

\TODO{The history of the foundations of mathematics has been \dots}

\paragraph{Set theories.}
A \emph{set theory} is a first-order theory having the usual logical connectives ($\top$, $\neg$, $\land$, $\lor$, $\to$, $\leftrightarrow$, $\exists$, $\forall$) plus two relation symbols: \emph{equality} ($=$) and \emph{membership} ($\in$). Variables (like $x,y,z,\ldots$) range over sets, and a set is meant to represent a collection of sets: $x \in y$ means that $x$ is a \emph{member} or an \emph{element} of $y$.

%Formulas of set theory are thus described by the following grammar: 

% \[\begin{array}{rrl}
%   \varphi & \grameq & \bot \mid \neg \varphi \mid \varphi \land \varphi \mid \varphi \lor \varphi \\
%   & & \mid \forall x.\, \varphi \mid \exists x.\, \varphi \\
%   & & \mid x = y \mid x \in y .
% % \TODO{Oh no, we need $\leftrightarrow$!!!}
% \end{array}\]

Sets do not posses any internal structure other than their \emph{extension}, \ie{} the elements they contain. The \emph{axiom of extensionality} formalizes this fact by requiring that sets having the same extension are in fact the same set:

\[\forall x y.\, x = y \leftrightarrow \forall z. \, z \in x \leftrightarrow z \in y \quad \tag{\SetExt} \]

A natural way to form a collection of sets is by gathering every set $x$ satisfying a given logic formula $\varphi$; this collection is expressed in symbols by $\Compr x \varphi$, reading ``the collection of all $x$'s such that $\varphi$ holds''. This procedure is called \emph{comprehension}, and is very powerful as it basically identifies sets with logic formulas. \TODO{FALSO!} A very natural property would be that collections specified by comprehension are sets themselves, as the \emph{axiom schema of comprehension} requires:

\[ \exists y.\, \forall x.\, x \in y \leftrightarrow \varphi  \quad \tag{\SetCompr} \]

(where $y$ does not occur in $\varphi$; $\varphi$ may however have any number of free variables, and we implicitly assume axiom schemata to be universally closed.)

We can just denote with $\Compr x \varphi$ the set that witnesses the existential ``$\exists y$'', which is unique by extensionality. Set comprehension is actually an axiom \emph{schema}: the schema describes an axiom for every formula $\varphi$. Can all formulas be allowed? Unfortunately not: the infamous \emph{Russel's paradox} relies exactly on \emph{unrestricted} comprehension, and it is straightforward to obtain a contradiction by taking comprehension of a formula as simple as $\varphi \defeq x \not\in x$.\footnotemark{}

\footnotetext{By $x\not\in x$ we mean $\neg {(x \in x)}$. }

There are several ways to restrict \SetCompr{} so to avoid Russel's paradox. To a certain extent, Russel's contradiction is caused by malicious circularity in the formation of sets: the characterizing formula $\varphi$ spans across all sets, even the set that is being formed. \ZF's way to avoid circularity is to only allow comprehension of guarded formulas, of the form $x \in y \land \varphi$ for some $y\neq x$ and arbitrary $\varphi$. The resulting set is usually denoted by $\Compr {x \in y} \varphi$, and this flavor of comprehension is known as \emph{axiom schema of separation}. In this way, self-reference is not allowed because it is only possible to \emph{separate} subsets of sets that already exist; moreover, additional axioms of \ZF{} force sets to have a \emph{well-founded} structure (most notably, the \emph{axiom of regularity}).

But after all, circularity is not necessarily evil. \NF's way to avoid inconsistencies is not to forbid circularity from the structure of sets themselves, but to forbid it from the \emph{description} of sets. \TODO{} to restrict the axiom of comprehension to only \emph{stratified} instances. A stratification of a formula is the assignment of a natural number to each \emph{bound} variable (we write $x^i$ to mean that the variable $x$ has been assigned the number $i$) in such a way that:
\begin{itemize}
  \item for every subformula $x^i = y^j$, it must hold $i=j$;
  \item for every subformula $x^i \in y^j$, it must hold $i+1=j$.
\end{itemize}
(We do not put too much stress on stratification, as we will not employ it directly, see the next subsection.)

\TODO{For instance}, the schema of stratified comprehension does not force the collection $\Compr x {x \not\in x}$ to be a set, because the corresponding instance of comprehension cannot be stratified:

\[ \exists y^{i+1}.\, \forall x^i.\, x^i \in y^{i+1} \leftrightarrow x^{\stkout{\textcolor{red}i}} \not\in x^{\stkout{\textcolor{red}i}}. \]

As a consequence, Russel's paradox is avoided; however, various bizarre sets are allowed to exist. For instance the \emph{universe}, the collection $\Compr x \top$ of all sets, is itself a set, because the corresponding instance of comprehension is stratified:

\[ \exists y^{i+1}.\, \forall x^i.\, x^i \in y^{i+1} \leftrightarrow \top. \]

Even more \TODO{bizzarly}, one can for example define the set of all ordinals, or the set of all cardinals, which are inconcievable in \ZF{} where they can only be understood as \emph{proper classes}.

\TODO{dire che NF non e' ancora provata consistente. Randall Holmes?}


\subsection{Quantifier-free Comprehension}

In this paper we consider weaker fragments of full-fledged \NF{}, obtained by restricting the axiom of stratified comprehension to only formulas $\varphi$ that are quantifier-free. \TODO{dire che esistono in letterature e citare articoli.}

In the case of quantifier-free stratified comprehension, we can actually drop the axiom schema of comprehension in favour of an equivalent axiomatization that employs only a few set operators ($\Universe, \Complement \Placeholder, \Union \Placeholder \Placeholder, \Sing\Placeholder, \Essence\Placeholder$) and the corresponding characterizing axioms. We will describe these set operators in the rest of this subsection, but first of all let us sketch the reason why such a \TODO{}

Recall that by the definition of stratification, only bound variables are assigned indices. Thus, in an instance of the comprehension schema like $\exists y.\, \forall x.\, x \in y \leftrightarrow \varphi$, when $\varphi$ is quantifier-free, only $x$ and $y$ are to be assigned an index. Note that subformulas of $\varphi$ of the form $z = w$ or $z \in w$ which mention at least one free variable are trivially stratified. Moreover, since $y$ cannot occur in $\varphi$ by hypothesis, the only atomic formulas that do not mention any free variable are either $x=x$ (clearly stratified) or $x\in x$ (not stratifiable).
% 
Summarizing, quantifier-free stratification is equivalent to requiring that $x\in x$ does not occur as a subformula of $\varphi$.

\TODO{This means that we can drop the definition of stratified, and use a much simplier syntactic restriction on $\varphi$'s}

To understand what operations on sets are necessary to replace the schema of comprehension, let us \TODO{??? the value} of $\Compr x \varphi$ when $\varphi$ is stratified and quantifier-free, proceeding by cases on the structure of $\varphi$:

\[\begin{array}{lcll}
  \Compr x {x = x} & = & \Universe \\
  \Compr x {x = y} & = & \Sing y \\
  \Compr x {y = x} & = & \Sing y \\
  \Compr x {y = z} & = &
    \begin{cases}
      \Universe & \text{if } y = z\\
      \Complement \Universe & \text{otherwise}
    \end{cases}\\
  \Compr x {x \in y} & = & y \\
  \Compr x {y \in x} & = & \Essence y \\
  \Compr x {y \in z} & = &
    \begin{cases}
      \Universe & \text{if } y \in z\\
      \Complement \Universe & \text{otherwise}
    \end{cases}\\
  \Compr x {\neg\varphi} & = & \Complement {\Compr x \varphi} \\
  \Compr x {\varphi \lor \varphi'} & = & \Union {\Compr x \varphi} {\Compr x {\varphi'}} \\
\end{array}\]
(where $x\neq y$ and $x \neq z$.)

\noindent \TODO{The required operators are thus:}
\begin{enumerate} \renewcommand\labelitemi{--}
  \item $\Universe$ denotes the universal set:
    \begin{flalign*} \hspace{50pt} %
      \forall z.\, z \in \Universe \sctag{Universe} %
      && \end{flalign*}
  \item $\Complement \Placeholder$ denotes the set complement:
  \begin{flalign*} \hspace{50pt} %
      \forall z.\, z \in \Complement x \leftrightarrow \neg (z \in x) \sctag{Complement}
      && \end{flalign*}
  \item $\Union \Placeholder \Placeholder$ denotes the set union:
  \begin{flalign*} \hspace{50pt} %
      \forall z.\, z \in \Union x y \leftrightarrow z \in x \lor z \in y \sctag{Union}
      && \end{flalign*}
  \item $\Sing\Placeholder$ denotes the singleton:
  \begin{flalign*} \hspace{50pt} %
      \forall z.\, z \in \Sing x \leftrightarrow x = z \sctag{Singleton} 
      && \end{flalign*}
  \item $\Essence\Placeholder$ denotes the ``essence'' of a set:
  \begin{flalign*} \hspace{50pt} %
      \forall z.\, z \in \Essence{x} \leftrightarrow x \in z \sctag{Essence} 
      && \end{flalign*}
\end{enumerate}

Singleton, union, and complement are familiar operations on sets that do not need further clarification. The universal set is unconventional, but quite intuitive. In \Cref{sect:nf2} we are going to provide a model for \NFTWO{}, which is the theory obtained by \TODO{extensionality + singleton, union, complement, and universal set.}

As for the last operator, \TODO{The essence is the most unfamiliar (and the most problematic, when encoding later). It is called essence because X by Y. } \TODO{\NFO{}, which we will study in \Cref{sect:nfo}}

\subsection{Sets in Coq}
The goal of this paper is to formalize in the Coq proof assistant models for \NFTWO{} and \NFO{} (let us temporarily abbreviate \NFTWO/\NFO{} with \NFX{}).

The basic idea is performing a \emph{shallow embedding} of \NFX{} in \Coq, where:

\begin{itemize}
  \item 
    The logic formulas of \NFX{} are interpreted in \Coq{} so that logical connectives of \NFX{} are mapped to the corresponding ones in \Coq{}. One slight inconvenience is that \NFX{} is a theory ??? in classical logic, while \Coq{} uses constructive logic. \TODO{}
  \item 
    The predicates of \NFX{} (equality and membership) plus the various set operators are encoded as \Coq{} terms, 

    One important point is that, from now on, we will denote the equality relation on \NFX{} sets by $\equiv$ instead of $=$, so to distinguish it from \Coq{} \emph{intensional} equality $=$.
\end{itemize}

Our starting point the is the classic formalization of \ZF{} (or more precisely \ZFC{} \TODO{}) in Coq by Benjamin Werner. \TODO{based on Aczel \cite{ACZEL197855}} see \Cref{sect:zf}.

\section{Roadmap}
\Cref{sect:zf}
\Cref{sect:nf2}
\Cref{sect:nfo}

\noindent
\paragraph{Contributions.}

\section{\ZF}
\label{sect:zf}
\input{ZF.tex}

\section{\NFTWO}
\label{sect:nf2}
\input{NF2.tex}

\section{\NFO}
\label{sect:nfo}
\input{NFO.tex}

\section{Discussion}
\subsection{Related Work}
\subsection{Future Work}
\begin{itemize}
  \item Decidable + finite indexing sets X Y (the important is that they are closed under union) THEN decidable, computational equality and membership
\end{itemize}



%%
%% The acknowledgments section is defined using the "acks" environment
%% (and NOT an unnumbered section). This ensures the proper
%% identification of the section in the article metadata, and the
%% consistent spelling of the heading.
% \begin{acks}
% To Robert, for the bagels and explaining CMYK and color spaces.
% \end{acks}

%%
%% The next two lines define the bibliography style to be used, and
%% the bibliography file.
\bibliographystyle{ACM-Reference-Format}
\bibliography{main}

%%
%% If your work has an appendix, this is the place to put it.
\appendix


\end{document}
\endinput
